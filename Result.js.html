<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Result.js - pHTML</title>
    
    <meta name="description" content="A tool for transforming HTML with JavaScript" />
    
    
    
    <meta property="og:title" content="pHTML"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://phtml.io/phtml.png"/>
    <meta property="og:site_name" content="Docdash"/>
    <meta property="og:url" content="https://phtml.io/"/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon" type="image/x-icon" href="https://phtml.io/favicon.ico"></head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="./">pHTML</a></h2><h2></h2><h2><a href="https://gitter.im/postcss" >Support</a></h2><h3>Classes</h3><ul><li><a href="AttributeList.html">AttributeList</a><ul class='methods'><li data-type='method' style='display: none;'><a href="AttributeList.html#.from">from</a></li><li data-type='method' style='display: none;'><a href="AttributeList.html#add">add</a></li><li data-type='method' style='display: none;'><a href="AttributeList.html#clone">clone</a></li><li data-type='method' style='display: none;'><a href="AttributeList.html#contains">contains</a></li><li data-type='method' style='display: none;'><a href="AttributeList.html#get">get</a></li><li data-type='method' style='display: none;'><a href="AttributeList.html#indexOf">indexOf</a></li><li data-type='method' style='display: none;'><a href="AttributeList.html#remove">remove</a></li><li data-type='method' style='display: none;'><a href="AttributeList.html#toggle">toggle</a></li><li data-type='method' style='display: none;'><a href="AttributeList.html#toJSON">toJSON</a></li><li data-type='method' style='display: none;'><a href="AttributeList.html#toString">toString</a></li></ul></li><li><a href="Comment.html">Comment</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Comment.html#after">after</a></li><li data-type='method' style='display: none;'><a href="Comment.html#append">append</a></li><li data-type='method' style='display: none;'><a href="Comment.html#appendTo">appendTo</a></li><li data-type='method' style='display: none;'><a href="Comment.html#before">before</a></li><li data-type='method' style='display: none;'><a href="Comment.html#clone">clone</a></li><li data-type='method' style='display: none;'><a href="Comment.html#prepend">prepend</a></li><li data-type='method' style='display: none;'><a href="Comment.html#remove">remove</a></li><li data-type='method' style='display: none;'><a href="Comment.html#replaceWith">replaceWith</a></li><li data-type='method' style='display: none;'><a href="Comment.html#toJSON">toJSON</a></li><li data-type='method' style='display: none;'><a href="Comment.html#toString">toString</a></li><li data-type='method' style='display: none;'><a href="Comment.html#visit">visit</a></li><li data-type='method' style='display: none;'><a href="Comment.html#warn">warn</a></li></ul></li><li><a href="Container.html">Container</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Container.html#after">after</a></li><li data-type='method' style='display: none;'><a href="Container.html#append">append</a></li><li data-type='method' style='display: none;'><a href="Container.html#appendTo">appendTo</a></li><li data-type='method' style='display: none;'><a href="Container.html#before">before</a></li><li data-type='method' style='display: none;'><a href="Container.html#lastNth">lastNth</a></li><li data-type='method' style='display: none;'><a href="Container.html#lastNthElement">lastNthElement</a></li><li data-type='method' style='display: none;'><a href="Container.html#nth">nth</a></li><li data-type='method' style='display: none;'><a href="Container.html#nthElement">nthElement</a></li><li data-type='method' style='display: none;'><a href="Container.html#prepend">prepend</a></li><li data-type='method' style='display: none;'><a href="Container.html#remove">remove</a></li><li data-type='method' style='display: none;'><a href="Container.html#replaceAll">replaceAll</a></li><li data-type='method' style='display: none;'><a href="Container.html#replaceWith">replaceWith</a></li><li data-type='method' style='display: none;'><a href="Container.html#visit">visit</a></li><li data-type='method' style='display: none;'><a href="Container.html#walk">walk</a></li><li data-type='method' style='display: none;'><a href="Container.html#warn">warn</a></li></ul></li><li><a href="Doctype.html">Doctype</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Doctype.html#after">after</a></li><li data-type='method' style='display: none;'><a href="Doctype.html#append">append</a></li><li data-type='method' style='display: none;'><a href="Doctype.html#appendTo">appendTo</a></li><li data-type='method' style='display: none;'><a href="Doctype.html#before">before</a></li><li data-type='method' style='display: none;'><a href="Doctype.html#clone">clone</a></li><li data-type='method' style='display: none;'><a href="Doctype.html#prepend">prepend</a></li><li data-type='method' style='display: none;'><a href="Doctype.html#remove">remove</a></li><li data-type='method' style='display: none;'><a href="Doctype.html#replaceWith">replaceWith</a></li><li data-type='method' style='display: none;'><a href="Doctype.html#toJSON">toJSON</a></li><li data-type='method' style='display: none;'><a href="Doctype.html#toString">toString</a></li><li data-type='method' style='display: none;'><a href="Doctype.html#visit">visit</a></li><li data-type='method' style='display: none;'><a href="Doctype.html#warn">warn</a></li></ul></li><li><a href="Element.html">Element</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Element.html#after">after</a></li><li data-type='method' style='display: none;'><a href="Element.html#append">append</a></li><li data-type='method' style='display: none;'><a href="Element.html#appendTo">appendTo</a></li><li data-type='method' style='display: none;'><a href="Element.html#before">before</a></li><li data-type='method' style='display: none;'><a href="Element.html#clone">clone</a></li><li data-type='method' style='display: none;'><a href="Element.html#lastNth">lastNth</a></li><li data-type='method' style='display: none;'><a href="Element.html#lastNthElement">lastNthElement</a></li><li data-type='method' style='display: none;'><a href="Element.html#nth">nth</a></li><li data-type='method' style='display: none;'><a href="Element.html#nthElement">nthElement</a></li><li data-type='method' style='display: none;'><a href="Element.html#prepend">prepend</a></li><li data-type='method' style='display: none;'><a href="Element.html#remove">remove</a></li><li data-type='method' style='display: none;'><a href="Element.html#replaceAll">replaceAll</a></li><li data-type='method' style='display: none;'><a href="Element.html#replaceWith">replaceWith</a></li><li data-type='method' style='display: none;'><a href="Element.html#toJSON">toJSON</a></li><li data-type='method' style='display: none;'><a href="Element.html#toString">toString</a></li><li data-type='method' style='display: none;'><a href="Element.html#visit">visit</a></li><li data-type='method' style='display: none;'><a href="Element.html#walk">walk</a></li><li data-type='method' style='display: none;'><a href="Element.html#warn">warn</a></li></ul></li><li><a href="Fragment.html">Fragment</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Fragment.html#after">after</a></li><li data-type='method' style='display: none;'><a href="Fragment.html#append">append</a></li><li data-type='method' style='display: none;'><a href="Fragment.html#appendTo">appendTo</a></li><li data-type='method' style='display: none;'><a href="Fragment.html#before">before</a></li><li data-type='method' style='display: none;'><a href="Fragment.html#clone">clone</a></li><li data-type='method' style='display: none;'><a href="Fragment.html#lastNth">lastNth</a></li><li data-type='method' style='display: none;'><a href="Fragment.html#lastNthElement">lastNthElement</a></li><li data-type='method' style='display: none;'><a href="Fragment.html#nth">nth</a></li><li data-type='method' style='display: none;'><a href="Fragment.html#nthElement">nthElement</a></li><li data-type='method' style='display: none;'><a href="Fragment.html#prepend">prepend</a></li><li data-type='method' style='display: none;'><a href="Fragment.html#remove">remove</a></li><li data-type='method' style='display: none;'><a href="Fragment.html#replaceAll">replaceAll</a></li><li data-type='method' style='display: none;'><a href="Fragment.html#replaceWith">replaceWith</a></li><li data-type='method' style='display: none;'><a href="Fragment.html#toJSON">toJSON</a></li><li data-type='method' style='display: none;'><a href="Fragment.html#toString">toString</a></li><li data-type='method' style='display: none;'><a href="Fragment.html#visit">visit</a></li><li data-type='method' style='display: none;'><a href="Fragment.html#walk">walk</a></li><li data-type='method' style='display: none;'><a href="Fragment.html#warn">warn</a></li></ul></li><li><a href="Node.html">Node</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Node.html#after">after</a></li><li data-type='method' style='display: none;'><a href="Node.html#append">append</a></li><li data-type='method' style='display: none;'><a href="Node.html#appendTo">appendTo</a></li><li data-type='method' style='display: none;'><a href="Node.html#before">before</a></li><li data-type='method' style='display: none;'><a href="Node.html#prepend">prepend</a></li><li data-type='method' style='display: none;'><a href="Node.html#remove">remove</a></li><li data-type='method' style='display: none;'><a href="Node.html#replaceWith">replaceWith</a></li><li data-type='method' style='display: none;'><a href="Node.html#visit">visit</a></li><li data-type='method' style='display: none;'><a href="Node.html#warn">warn</a></li></ul></li><li><a href="NodeList.html">NodeList</a><ul class='methods'><li data-type='method' style='display: none;'><a href="NodeList.html#.from">from</a></li><li data-type='method' style='display: none;'><a href="NodeList.html#clone">clone</a></li><li data-type='method' style='display: none;'><a href="NodeList.html#pop">pop</a></li><li data-type='method' style='display: none;'><a href="NodeList.html#push">push</a></li><li data-type='method' style='display: none;'><a href="NodeList.html#shift">shift</a></li><li data-type='method' style='display: none;'><a href="NodeList.html#splice">splice</a></li><li data-type='method' style='display: none;'><a href="NodeList.html#toJSON">toJSON</a></li><li data-type='method' style='display: none;'><a href="NodeList.html#toString">toString</a></li><li data-type='method' style='display: none;'><a href="NodeList.html#unshift">unshift</a></li></ul></li><li><a href="PHTML.html">PHTML</a><ul class='methods'><li data-type='method' style='display: none;'><a href="PHTML.html#.process">process</a></li><li data-type='method' style='display: none;'><a href="PHTML.html#.use">use</a></li><li data-type='method' style='display: none;'><a href="PHTML.html#process">process</a></li><li data-type='method' style='display: none;'><a href="PHTML.html#use">use</a></li></ul></li><li><a href="Plugin.html">Plugin</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Plugin.html#process">process</a></li></ul></li><li><a href="Result.html">Result</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Result.html#normalize">normalize</a></li><li data-type='method' style='display: none;'><a href="Result.html#toJSON">toJSON</a></li><li data-type='method' style='display: none;'><a href="Result.html#visit">visit</a></li><li data-type='method' style='display: none;'><a href="Result.html#warn">warn</a></li></ul></li><li><a href="Text.html">Text</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Text.html#after">after</a></li><li data-type='method' style='display: none;'><a href="Text.html#append">append</a></li><li data-type='method' style='display: none;'><a href="Text.html#appendTo">appendTo</a></li><li data-type='method' style='display: none;'><a href="Text.html#before">before</a></li><li data-type='method' style='display: none;'><a href="Text.html#clone">clone</a></li><li data-type='method' style='display: none;'><a href="Text.html#prepend">prepend</a></li><li data-type='method' style='display: none;'><a href="Text.html#remove">remove</a></li><li data-type='method' style='display: none;'><a href="Text.html#replaceWith">replaceWith</a></li><li data-type='method' style='display: none;'><a href="Text.html#toJSON">toJSON</a></li><li data-type='method' style='display: none;'><a href="Text.html#toString">toString</a></li><li data-type='method' style='display: none;'><a href="Text.html#visit">visit</a></li><li data-type='method' style='display: none;'><a href="Text.html#warn">warn</a></li></ul></li></ul>
<h3>Links</h3><ul><li><a href="https://github.com/phtmlorg/phtml" >GitHub</a></li></ul></nav>

<div id="main">
    
    <h1 class="page-title">Result.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import normalize from './normalize';
import parseHTML from './parseHTML';
import treeAdapter from './parseHTMLTreeAdapter';
import Comment from './Comment';
import Doctype from './Doctype';
import Element from './Element';
import Fragment from './Fragment';
import Text from './Text';
import visit, { getVisitors } from './visit';

/** Return a new syntax tree {@link Result} from a processed input. */
class Result {
	/**
	* @param {string} html - HTML string to be parsed.
	* @param {ProcessOptions} [processOptions] - Custom settings applied to the {@link Result}.
	*/
	constructor (html, processOptions) {
		/** Type identifier of the Result
		* @type {'result'} */
		this.type = 'result';

		/** Path to the HTML source file. You should always set from, because it is used in source map generation and syntax error messages
		* @type {string} */
		// the "to" and "from" locations are always string values
		this.from = 'from' in Object(processOptions) &amp;&amp; processOptions.from !== undefined &amp;&amp; processOptions.from !== null
			? String(processOptions.from)
		: '';

		/** Path to the HTML output file
		* @type {string} */
		this.to = 'to' in Object(processOptions) &amp;&amp; processOptions.to !== undefined &amp;&amp; processOptions.to !== null
			? String(processOptions.to)
		: this.from;

		/** List of the elements that only have a start tag, as they cannot have any content
		* @type {string[]} */
		this.voidElements = 'voidElements' in Object(processOptions)
			? [].concat(Object(processOptions).voidElements || [])
		: Result.voidElements;

		/** Normalized plugins and visitors
		* @type {Object&lt;string, Function[]>} */
		// prepare visitors (which may be functions or visitors)
		this.visitors = getVisitors(Object(processOptions).visitors);

		/** List of the messages gathered during transformations
		* @type {Message[]} */
		this.messages = [];

		// prepare the result object
		this.input = { html: html, from: this.from, to: this.to };

		// parse the html and transform it into nodes
		const documentFragment = parseHTML(html, { voidElements: this.voidElements });

		/** Root Node
		* @type {Node} */
		this.root = transform(documentFragment, this);
	}

	/** Current {@link Root} as a String. */
	get html () {
		return String(this.root);
	}

	/**
	* Messages that are warnings.
	* @returns {Array&lt;MessageWarning>}
	**/
	get warnings () {
		return /** @type Message[] */(this.messages).filter(
			message => Object(message).type === 'warning'
		);
	}

	/**
	* Return a normalized node whose instances match the current {@link Result}.
	* @param {Node} [node] - Node to be normalized.
	* @example
	* result.normalize(someNode)
	*/
	normalize (node) {
		return normalize(node);
	}

	/**
	* Current {@link Root} as an Object.
	* @returns {Object}
	*/
	toJSON () {
		return this.root.toJSON();
	}

	/**
	* Transform the current {@link Node} and any descendants using visitors.
	* @param {Node} node - {@link Node} to be visited.
	* @param {Object} [overrideVisitors] - Alternative visitors to be used in place of {@link Result} visitors.
	* @returns {ResultPromise}
	* @example
	* await result.visit(someNode)
	* @example
	* await result.visit() // visit using the root of the current result
	* @example
	* await result.visit(root, {
	*   Element () {
	*     // do something to an element
	*   }
	* })
	*/
	visit (node, overrideVisitors) {
		const nodeToUse = 0 in arguments ? node : this.root;

		return visit(nodeToUse, this, overrideVisitors);
	}

	/**
	* Add a warning to the current {@link Root}.
	* @param {string} text - Message being sent as the warning.
	* @param {Object} [opts] - Additional information about the warning.
	* @example
	* result.warn('Something went wrong')
	* @example
	* result.warn('Something went wrong', {
	*   node: someNode,
	*   plugin: somePlugin
	* })
	*/
	warn (text, rawopts) {
		const opts = Object(rawopts);

		if (!opts.plugin) {
			if (Object(this.currentPlugin).name) {
				opts.plugin = this.currentPlugin.name
			}
		}

		this.messages.push({ type: 'warning', text, opts });
	}

	static voidElements = [
		'area',
		'base',
		'br',
		'col',
		'command',
		'embed',
		'hr',
		'img',
		'input',
		'keygen',
		'link',
		'meta',
		'param',
		'source',
		'track',
		'wbr'
	];
}

function transform (node, result) {
	const hasSource = node.sourceCodeLocation === Object(node.sourceCodeLocation);
	const source = hasSource
		? {
			startOffset: node.sourceCodeLocation.startOffset,
			endOffset: node.sourceCodeLocation.endOffset,
			startInnerOffset: Object(node.sourceCodeLocation.startTag).endOffset || node.sourceCodeLocation.startOffset,
			endInnerOffset: Object(node.sourceCodeLocation.endTag).startOffset || node.sourceCodeLocation.endOffset,
			input: result.input
		}
	: {
		startOffset: 0,
		startInnerOffset: 0,
		endInnerOffset: result.input.html.length,
		endOffset: result.input.html.length,
		input: result.input
	};

	if (Object(node.sourceCodeLocation).startTag) {
		source.before = result.input.html.slice(source.startOffset, source.startInnerOffset - 1).match(/\s*\/?$/)[0]
	}

	if (Object(node.sourceCodeLocation).endTag) {
		source.after = result.input.html.slice(source.endInnerOffset + 2 + node.nodeName.length, source.endOffset - 1)
	}

	const $node = treeAdapter.isCommentNode(node)
		? new Comment({ comment: node.data, source, result })
	: treeAdapter.isDocumentTypeNode(node)
		? new Doctype(Object.assign(node, { result, source: Object.assign({}, node.source, source) }))
	: treeAdapter.isElementNode(node)
		? new Element({
			name: result.input.html.slice(source.startOffset + 1, source.startOffset + 1 + node.nodeName.length),
			attrs: node.attrs.map(attr => attr.raw),
			nodes: node.childNodes instanceof Array ? node.childNodes.map(child => transform(child, result)) : null,
			isSelfClosing: /\//.test(source.before),
			isWithoutEndTag: !Object(node.sourceCodeLocation).endTag,
			isVoid: result.voidElements.includes(node.tagName),
			result,
			source
		})
	: treeAdapter.isTextNode(node)
		? new Text({
			data: hasSource ? source.input.html.slice(
				source.startInnerOffset,
				source.endInnerOffset
			) : node.value,
			result,
			source
		})
	: new Fragment({
		nodes: node.childNodes instanceof Array ? node.childNodes.map(child => transform(child, result)) : null,
		result,
		source
	});

	return $node;
}

export default Result;

/**
* Promise to return a syntax tree.
* @typedef {Promise&lt;Result>} ResultPromise
* @example
* resultPromise.then(result => {
*  // do something with the result
* })
*/
/**
* @typedef {Object} ProcessOptions - Custom settings applied to the {@link Result}.
* @property {string} [from] - Source input location.
* @property {string} [to] - Destination output location.
* @property {string[]} [voidElements] - Void elements.
*/
/**
* @typedef {Object} ResultType - Result of a pHTML transformation.
* @property {string} from - Path to the HTML source file. You should always set from, because it is used in source map generation and syntax error messages.
* @property {string} to - Path to the HTML output file.
* @property {Fragment} root - Object representing the parsed nodes of the HTML file.
* @property {Message[]} messages - List of the messages gathered during transformations.
* @property {string[]} voidElements - List of the elements that only have a start tag, as they cannot have any content.
*/
/**
* @typedef {Object} Message - Message gathered during transformations.
* @property {string} type - Type of message.
* @property {string} text - Message itself.
* @property {MessageInfo} [opts] - Information about the message.
*/
/**
* @typedef {Object} MessageInfo - Information about the message.
* @property {Plugin} [plugin] - Current plugin.
*/
/**
* @typedef {{ type: "warning" }} MessageWarning - Warning message gathered during transformations.
* @extends {Message}
*/
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


    <link type="text/css" rel="stylesheet" href="styles/custom.css">
    
</body>
</html>
